{"ast":null,"code":"import { BehaviorSubject, concatMap, delay, fromEvent, map, merge, scan, shareReplay, startWith, take, takeUntil, timer } from 'rxjs';\nimport { salto, tiempoJuego, whackAMole } from '../custom-operators';\nimport { SCORE_ACTION } from '../topo/topo.enum';\nconst createStartButtonObservable = btnNativeElement => fromEvent(btnNativeElement, 'click').pipe(map(() => SCORE_ACTION.RESET), shareReplay(1));\nconst createScoreObservable = (startButtonClicked$, moles) => {\n  const molesClickedArray$ = moles.map(({\n    nativeElement\n  }) => fromEvent(nativeElement, 'click').pipe(whackAMole(nativeElement)));\n  return merge(...molesClickedArray$, startButtonClicked$).pipe(scan((score, action) => action === SCORE_ACTION.RESET ? 0 : score + 1, 0), startWith(0));\n};\nexport const createGameObservablesFn = () => {\n  const delayTime = 3;\n  const gameDuration = 10;\n  const MILLISECOND = 1000;\n  return (btnNativeElement, moles, holes) => {\n    const startButtonClicked$ = createStartButtonObservable(btnNativeElement);\n    const score$ = createScoreObservable(startButtonClicked$, moles);\n    const delayGameMsg$ = startButtonClicked$.pipe(concatMap(() => timer(0, MILLISECOND).pipe(take(delayTime + 1), map(value => delayTime - value))));\n    const resetTime$ = startButtonClicked$.pipe(map(() => gameDuration));\n    const delayGameStart$ = startButtonClicked$.pipe(delay(delayTime * MILLISECOND), shareReplay(1));\n    const timeLeft$ = merge(resetTime$, delayGameStart$.pipe(tiempoJuego(gameDuration)));\n    const lastHoleUpdated = new BehaviorSubject(-1);\n    const createGame$ = delayGameStart$.pipe(concatMap(() => lastHoleUpdated.pipe(salto(holes, 350, 1000), takeUntil(timer(gameDuration * MILLISECOND)))));\n    return {\n      delayGameMsg$,\n      timeLeft$,\n      score$,\n      createGame$\n    };\n  };\n};","map":{"version":3,"names":["BehaviorSubject","concatMap","delay","fromEvent","map","merge","scan","shareReplay","startWith","take","takeUntil","timer","salto","tiempoJuego","whackAMole","SCORE_ACTION","createStartButtonObservable","btnNativeElement","pipe","RESET","createScoreObservable","startButtonClicked$","moles","molesClickedArray$","nativeElement","score","action","createGameObservablesFn","delayTime","gameDuration","MILLISECOND","holes","score$","delayGameMsg$","value","resetTime$","delayGameStart$","timeLeft$","lastHoleUpdated","createGame$"],"sources":["C:\\Users\\lamarcos\\Proyectos\\topo-app\\src\\app\\game\\helpers\\mole.observable.ts"],"sourcesContent":["import { ElementRef } from '@angular/core';\nimport {\n  BehaviorSubject,\n  Observable,\n  concatMap,\n  delay,\n  fromEvent,\n  map,\n  merge,\n  scan,\n  shareReplay,\n  startWith,\n  take,\n  takeUntil,\n  timer,\n} from 'rxjs';\nimport { salto, tiempoJuego, whackAMole } from '../custom-operators';\nimport { SCORE_ACTION } from '../topo/topo.enum';\n\nconst createStartButtonObservable = (btnNativeElement: HTMLButtonElement) =>\n  fromEvent(btnNativeElement, 'click').pipe(\n    map(() => SCORE_ACTION.RESET),\n    shareReplay(1),\n  );\n\nconst createScoreObservable = (startButtonClicked$: Observable<SCORE_ACTION>, moles: ElementRef<HTMLDivElement>[]) => {\n  const molesClickedArray$ = moles.map(({ nativeElement }) =>\n    fromEvent(nativeElement, 'click').pipe(whackAMole(nativeElement)),\n  );\n\n  return merge(...molesClickedArray$, startButtonClicked$).pipe(\n    scan((score, action) => (action === SCORE_ACTION.RESET ? 0 : score + 1), 0),\n    startWith(0),\n  );\n};\n\nexport const createGameObservablesFn = () => {\n  const delayTime = 3;\n  const gameDuration = 10;\n  const MILLISECOND = 1000;\n\n  return (\n    btnNativeElement: HTMLButtonElement,\n    moles: ElementRef<HTMLDivElement>[],\n    holes: ElementRef<HTMLDivElement>[],\n  ) => {\n    const startButtonClicked$ = createStartButtonObservable(btnNativeElement);\n    const score$ = createScoreObservable(startButtonClicked$, moles);\n    const delayGameMsg$ = startButtonClicked$.pipe(\n      concatMap(() =>\n        timer(0, MILLISECOND).pipe(\n          take(delayTime + 1),\n          map((value) => delayTime - value),\n        ),\n      ),\n    );\n\n    const resetTime$ = startButtonClicked$.pipe(map(() => gameDuration));\n    const delayGameStart$ = startButtonClicked$.pipe(delay(delayTime * MILLISECOND), shareReplay(1));\n    const timeLeft$ = merge(resetTime$, delayGameStart$.pipe(tiempoJuego(gameDuration)));\n    const lastHoleUpdated = new BehaviorSubject<number>(-1);\n    const createGame$ = delayGameStart$.pipe(\n      concatMap(() => lastHoleUpdated.pipe(salto(holes, 350, 1000), takeUntil(timer(gameDuration * MILLISECOND)))),\n    );\n\n    return {\n      delayGameMsg$,\n      timeLeft$,\n      score$,\n      createGame$,\n    };\n  };\n};\n"],"mappings":"AACA,SACEA,eAAe,EAEfC,SAAS,EACTC,KAAK,EACLC,SAAS,EACTC,GAAG,EACHC,KAAK,EACLC,IAAI,EACJC,WAAW,EACXC,SAAS,EACTC,IAAI,EACJC,SAAS,EACTC,KAAK,QACA,MAAM;AACb,SAASC,KAAK,EAAEC,WAAW,EAAEC,UAAU,QAAQ,qBAAqB;AACpE,SAASC,YAAY,QAAQ,mBAAmB;AAEhD,MAAMC,2BAA2B,GAAIC,gBAAmC,IACtEd,SAAS,CAACc,gBAAgB,EAAE,OAAO,CAAC,CAACC,IAAI,CACvCd,GAAG,CAAC,MAAMW,YAAY,CAACI,KAAK,CAAC,EAC7BZ,WAAW,CAAC,CAAC,CAAC,CACf;AAEH,MAAMa,qBAAqB,GAAGA,CAACC,mBAA6C,EAAEC,KAAmC,KAAI;EACnH,MAAMC,kBAAkB,GAAGD,KAAK,CAAClB,GAAG,CAAC,CAAC;IAAEoB;EAAa,CAAE,KACrDrB,SAAS,CAACqB,aAAa,EAAE,OAAO,CAAC,CAACN,IAAI,CAACJ,UAAU,CAACU,aAAa,CAAC,CAAC,CAClE;EAED,OAAOnB,KAAK,CAAC,GAAGkB,kBAAkB,EAAEF,mBAAmB,CAAC,CAACH,IAAI,CAC3DZ,IAAI,CAAC,CAACmB,KAAK,EAAEC,MAAM,KAAMA,MAAM,KAAKX,YAAY,CAACI,KAAK,GAAG,CAAC,GAAGM,KAAK,GAAG,CAAE,EAAE,CAAC,CAAC,EAC3EjB,SAAS,CAAC,CAAC,CAAC,CACb;AACH,CAAC;AAED,OAAO,MAAMmB,uBAAuB,GAAGA,CAAA,KAAK;EAC1C,MAAMC,SAAS,GAAG,CAAC;EACnB,MAAMC,YAAY,GAAG,EAAE;EACvB,MAAMC,WAAW,GAAG,IAAI;EAExB,OAAO,CACLb,gBAAmC,EACnCK,KAAmC,EACnCS,KAAmC,KACjC;IACF,MAAMV,mBAAmB,GAAGL,2BAA2B,CAACC,gBAAgB,CAAC;IACzE,MAAMe,MAAM,GAAGZ,qBAAqB,CAACC,mBAAmB,EAAEC,KAAK,CAAC;IAChE,MAAMW,aAAa,GAAGZ,mBAAmB,CAACH,IAAI,CAC5CjB,SAAS,CAAC,MACRU,KAAK,CAAC,CAAC,EAAEmB,WAAW,CAAC,CAACZ,IAAI,CACxBT,IAAI,CAACmB,SAAS,GAAG,CAAC,CAAC,EACnBxB,GAAG,CAAE8B,KAAK,IAAKN,SAAS,GAAGM,KAAK,CAAC,CAClC,CACF,CACF;IAED,MAAMC,UAAU,GAAGd,mBAAmB,CAACH,IAAI,CAACd,GAAG,CAAC,MAAMyB,YAAY,CAAC,CAAC;IACpE,MAAMO,eAAe,GAAGf,mBAAmB,CAACH,IAAI,CAAChB,KAAK,CAAC0B,SAAS,GAAGE,WAAW,CAAC,EAAEvB,WAAW,CAAC,CAAC,CAAC,CAAC;IAChG,MAAM8B,SAAS,GAAGhC,KAAK,CAAC8B,UAAU,EAAEC,eAAe,CAAClB,IAAI,CAACL,WAAW,CAACgB,YAAY,CAAC,CAAC,CAAC;IACpF,MAAMS,eAAe,GAAG,IAAItC,eAAe,CAAS,CAAC,CAAC,CAAC;IACvD,MAAMuC,WAAW,GAAGH,eAAe,CAAClB,IAAI,CACtCjB,SAAS,CAAC,MAAMqC,eAAe,CAACpB,IAAI,CAACN,KAAK,CAACmB,KAAK,EAAE,GAAG,EAAE,IAAI,CAAC,EAAErB,SAAS,CAACC,KAAK,CAACkB,YAAY,GAAGC,WAAW,CAAC,CAAC,CAAC,CAAC,CAC7G;IAED,OAAO;MACLG,aAAa;MACbI,SAAS;MACTL,MAAM;MACNO;KACD;EACH,CAAC;AACH,CAAC"},"metadata":{},"sourceType":"module","externalDependencies":[]}