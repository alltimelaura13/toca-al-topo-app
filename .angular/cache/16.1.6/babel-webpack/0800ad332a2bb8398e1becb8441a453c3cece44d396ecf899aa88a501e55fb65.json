{"ast":null,"code":"import { BehaviorSubject, concatMap, delay, fromEvent, map, merge, scan, shareReplay, startWith, take, takeUntil, timer } from 'rxjs';\nimport { salto, tiempoJuego, tocarAlTopo } from '../custom-operators';\nimport { SCORE_ACTION } from '../topo/topo.enum';\nconst createStartButtonObservable = btnNativeElement => fromEvent(btnNativeElement, 'click').pipe(map(() => SCORE_ACTION.RESET), shareReplay(1));\nconst createScoreObservable = (startButtonClicked$, moles) => {\n  const molesClickedArray$ = moles.map(({\n    nativeElement\n  }) => fromEvent(nativeElement, 'click').pipe(tocarAlTopo(nativeElement)));\n  return merge(...molesClickedArray$, startButtonClicked$).pipe(scan((score, action) => action === SCORE_ACTION.RESET ? 0 : score + 1, 0), startWith(0));\n};\nexport const createGameObservablesFn = dificultad => {\n  const delayTime = 3;\n  const gameDuration = 10;\n  const MILLISECOND = 1000;\n  let tiempoEntrada = 350;\n  let tiempoSalida = 1000;\n  switch (dificultad) {\n    case 1:\n      tiempoEntrada = 600;\n      tiempoSalida = 1500;\n      break;\n    case 2:\n      tiempoEntrada = 350;\n      tiempoSalida = 1000;\n      break;\n    case 3:\n      tiempoEntrada = 150;\n      tiempoSalida = 600;\n      break;\n    default:\n      tiempoEntrada = 350;\n      tiempoSalida = 1000;\n      break;\n  }\n  return (btnNativeElement, moles, holes) => {\n    const startButtonClicked$ = createStartButtonObservable(btnNativeElement);\n    const score$ = createScoreObservable(startButtonClicked$, moles);\n    const delayGameMsg$ = startButtonClicked$.pipe(concatMap(() => timer(0, MILLISECOND).pipe(take(delayTime + 1), map(value => delayTime - value))));\n    const resetTime$ = startButtonClicked$.pipe(map(() => gameDuration));\n    const delayGameStart$ = startButtonClicked$.pipe(delay(delayTime * MILLISECOND), shareReplay(1));\n    const timeLeft$ = merge(resetTime$, delayGameStart$.pipe(tiempoJuego(gameDuration)));\n    const lastHoleUpdated = new BehaviorSubject(-1);\n    const createGame$ = delayGameStart$.pipe(concatMap(() => lastHoleUpdated.pipe(salto(holes, tiempoEntrada, tiempoSalida), takeUntil(timer(gameDuration * MILLISECOND)))));\n    return {\n      delayGameMsg$,\n      timeLeft$,\n      score$,\n      createGame$\n    };\n  };\n};","map":{"version":3,"names":["BehaviorSubject","concatMap","delay","fromEvent","map","merge","scan","shareReplay","startWith","take","takeUntil","timer","salto","tiempoJuego","tocarAlTopo","SCORE_ACTION","createStartButtonObservable","btnNativeElement","pipe","RESET","createScoreObservable","startButtonClicked$","moles","molesClickedArray$","nativeElement","score","action","createGameObservablesFn","dificultad","delayTime","gameDuration","MILLISECOND","tiempoEntrada","tiempoSalida","holes","score$","delayGameMsg$","value","resetTime$","delayGameStart$","timeLeft$","lastHoleUpdated","createGame$"],"sources":["C:\\Users\\lamarcos\\Proyectos\\topo-app\\src\\app\\game\\helpers\\topo.observable.ts"],"sourcesContent":["import { ElementRef } from '@angular/core';\nimport {\n  BehaviorSubject,\n  Observable,\n  concatMap,\n  delay,\n  fromEvent,\n  map,\n  merge,\n  scan,\n  shareReplay,\n  startWith,\n  take,\n  takeUntil,\n  timer,\n} from 'rxjs';\nimport { salto, tiempoJuego, tocarAlTopo } from '../custom-operators';\nimport { SCORE_ACTION } from '../topo/topo.enum';\n\nconst createStartButtonObservable = (btnNativeElement: HTMLButtonElement) =>\n  fromEvent(btnNativeElement, 'click').pipe(\n    map(() => SCORE_ACTION.RESET),\n    shareReplay(1),\n  );\n\nconst createScoreObservable = (startButtonClicked$: Observable<SCORE_ACTION>, moles: ElementRef<HTMLDivElement>[]) => {\n  const molesClickedArray$ = moles.map(({ nativeElement }) =>\n    fromEvent(nativeElement, 'click').pipe(tocarAlTopo(nativeElement)),\n  );\n\n  return merge(...molesClickedArray$, startButtonClicked$).pipe(\n    scan((score, action) => (action === SCORE_ACTION.RESET ? 0 : score + 1), 0),\n    startWith(0),\n  );\n};\n\nexport const createGameObservablesFn = (dificultad?: any) => {\n  const delayTime = 3;\n  const gameDuration = 10;\n  const MILLISECOND = 1000;\n\n  let tiempoEntrada: number = 350;\n  let tiempoSalida: number = 1000;\n\n  switch (dificultad) {\n    case 1:\n      tiempoEntrada = 600;\n     tiempoSalida = 1500;\n      break;\n      case 2:\n        tiempoEntrada = 350;\n        tiempoSalida = 1000;\n      break;\n      case 3:\n        tiempoEntrada = 150;\n        tiempoSalida = 600;\n      break;\n    default:\n      tiempoEntrada = 350;\n     tiempoSalida = 1000;\n      break;\n  }\n  return (\n    btnNativeElement: HTMLButtonElement,\n    moles: ElementRef<HTMLDivElement>[],\n    holes: ElementRef<HTMLDivElement>[],\n  ) => {\n    const startButtonClicked$ = createStartButtonObservable(btnNativeElement);\n    const score$ = createScoreObservable(startButtonClicked$, moles);\n    const delayGameMsg$ = startButtonClicked$.pipe(\n      concatMap(() =>\n        timer(0, MILLISECOND).pipe(\n          take(delayTime + 1),\n          map((value) => delayTime - value),\n        ),\n      ),\n    );\n\n    const resetTime$ = startButtonClicked$.pipe(map(() => gameDuration));\n    const delayGameStart$ = startButtonClicked$.pipe(delay(delayTime * MILLISECOND), shareReplay(1));\n    const timeLeft$ = merge(resetTime$, delayGameStart$.pipe(tiempoJuego(gameDuration)));\n    const lastHoleUpdated = new BehaviorSubject<number>(-1);\n    const createGame$ = delayGameStart$.pipe(\n      concatMap(() => lastHoleUpdated.pipe(salto(holes, tiempoEntrada, tiempoSalida), takeUntil(timer(gameDuration * MILLISECOND)))),\n    );\n\n    return {\n      delayGameMsg$,\n      timeLeft$,\n      score$,\n      createGame$,\n    };\n  };\n};\n"],"mappings":"AACA,SACEA,eAAe,EAEfC,SAAS,EACTC,KAAK,EACLC,SAAS,EACTC,GAAG,EACHC,KAAK,EACLC,IAAI,EACJC,WAAW,EACXC,SAAS,EACTC,IAAI,EACJC,SAAS,EACTC,KAAK,QACA,MAAM;AACb,SAASC,KAAK,EAAEC,WAAW,EAAEC,WAAW,QAAQ,qBAAqB;AACrE,SAASC,YAAY,QAAQ,mBAAmB;AAEhD,MAAMC,2BAA2B,GAAIC,gBAAmC,IACtEd,SAAS,CAACc,gBAAgB,EAAE,OAAO,CAAC,CAACC,IAAI,CACvCd,GAAG,CAAC,MAAMW,YAAY,CAACI,KAAK,CAAC,EAC7BZ,WAAW,CAAC,CAAC,CAAC,CACf;AAEH,MAAMa,qBAAqB,GAAGA,CAACC,mBAA6C,EAAEC,KAAmC,KAAI;EACnH,MAAMC,kBAAkB,GAAGD,KAAK,CAAClB,GAAG,CAAC,CAAC;IAAEoB;EAAa,CAAE,KACrDrB,SAAS,CAACqB,aAAa,EAAE,OAAO,CAAC,CAACN,IAAI,CAACJ,WAAW,CAACU,aAAa,CAAC,CAAC,CACnE;EAED,OAAOnB,KAAK,CAAC,GAAGkB,kBAAkB,EAAEF,mBAAmB,CAAC,CAACH,IAAI,CAC3DZ,IAAI,CAAC,CAACmB,KAAK,EAAEC,MAAM,KAAMA,MAAM,KAAKX,YAAY,CAACI,KAAK,GAAG,CAAC,GAAGM,KAAK,GAAG,CAAE,EAAE,CAAC,CAAC,EAC3EjB,SAAS,CAAC,CAAC,CAAC,CACb;AACH,CAAC;AAED,OAAO,MAAMmB,uBAAuB,GAAIC,UAAgB,IAAI;EAC1D,MAAMC,SAAS,GAAG,CAAC;EACnB,MAAMC,YAAY,GAAG,EAAE;EACvB,MAAMC,WAAW,GAAG,IAAI;EAExB,IAAIC,aAAa,GAAW,GAAG;EAC/B,IAAIC,YAAY,GAAW,IAAI;EAE/B,QAAQL,UAAU;IAChB,KAAK,CAAC;MACJI,aAAa,GAAG,GAAG;MACpBC,YAAY,GAAG,IAAI;MAClB;IACA,KAAK,CAAC;MACJD,aAAa,GAAG,GAAG;MACnBC,YAAY,GAAG,IAAI;MACrB;IACA,KAAK,CAAC;MACJD,aAAa,GAAG,GAAG;MACnBC,YAAY,GAAG,GAAG;MACpB;IACF;MACED,aAAa,GAAG,GAAG;MACpBC,YAAY,GAAG,IAAI;MAClB;;EAEJ,OAAO,CACLhB,gBAAmC,EACnCK,KAAmC,EACnCY,KAAmC,KACjC;IACF,MAAMb,mBAAmB,GAAGL,2BAA2B,CAACC,gBAAgB,CAAC;IACzE,MAAMkB,MAAM,GAAGf,qBAAqB,CAACC,mBAAmB,EAAEC,KAAK,CAAC;IAChE,MAAMc,aAAa,GAAGf,mBAAmB,CAACH,IAAI,CAC5CjB,SAAS,CAAC,MACRU,KAAK,CAAC,CAAC,EAAEoB,WAAW,CAAC,CAACb,IAAI,CACxBT,IAAI,CAACoB,SAAS,GAAG,CAAC,CAAC,EACnBzB,GAAG,CAAEiC,KAAK,IAAKR,SAAS,GAAGQ,KAAK,CAAC,CAClC,CACF,CACF;IAED,MAAMC,UAAU,GAAGjB,mBAAmB,CAACH,IAAI,CAACd,GAAG,CAAC,MAAM0B,YAAY,CAAC,CAAC;IACpE,MAAMS,eAAe,GAAGlB,mBAAmB,CAACH,IAAI,CAAChB,KAAK,CAAC2B,SAAS,GAAGE,WAAW,CAAC,EAAExB,WAAW,CAAC,CAAC,CAAC,CAAC;IAChG,MAAMiC,SAAS,GAAGnC,KAAK,CAACiC,UAAU,EAAEC,eAAe,CAACrB,IAAI,CAACL,WAAW,CAACiB,YAAY,CAAC,CAAC,CAAC;IACpF,MAAMW,eAAe,GAAG,IAAIzC,eAAe,CAAS,CAAC,CAAC,CAAC;IACvD,MAAM0C,WAAW,GAAGH,eAAe,CAACrB,IAAI,CACtCjB,SAAS,CAAC,MAAMwC,eAAe,CAACvB,IAAI,CAACN,KAAK,CAACsB,KAAK,EAAEF,aAAa,EAAEC,YAAY,CAAC,EAAEvB,SAAS,CAACC,KAAK,CAACmB,YAAY,GAAGC,WAAW,CAAC,CAAC,CAAC,CAAC,CAC/H;IAED,OAAO;MACLK,aAAa;MACbI,SAAS;MACTL,MAAM;MACNO;KACD;EACH,CAAC;AACH,CAAC"},"metadata":{},"sourceType":"module","externalDependencies":[]}